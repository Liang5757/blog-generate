---
title: ç¦æ­¢ç”¨æˆ·è°ƒè¯•ç½‘ç«™
date: 2024-10-28 01:14:10
tags:
  - æµè§ˆå™¨
  - æŠ€å·§
categories:
  - å‰ç«¯
---
> webæƒ³ç¦æ­¢è°ƒè¯•ï¼Œæ²¡æœ‰ç»å¯¹å®‰å…¨çš„æ–¹å¼

## å¦™ç”¨1 debugger

### ç¤ºä¾‹

ç”¨`setInterval`æ‰§è¡Œ`debugger`ï¼Œæ‰“å¼€æ§åˆ¶å°å°±ä¼šæš‚åœä»£ç 

```javascript
(() => {
  function ban() {
    setInterval(() => { 
      debugger;
    }, 50);
  }
  ban();
})();
```
<!--more-->
## å¦™ç”¨2 debugger

### ç¤ºä¾‹

æ•ˆæœï¼šæ‰“å¼€æ§åˆ¶å°å°±è¿›å…¥debuggerï¼Œ**å¦‚æœè¿˜åƒ å¦™ç”¨1 çš„ç ´è§£ä¹‹æ³•è§£å†³ï¼Œæµè§ˆå™¨ä¼šè¢«å¡æ­»**

```javascript
(() => {
  let timeLimit = 50;
  setInterval(loop, 1);
  function loop() {
    let startTime = new Date();
    debugger;
    if (new Date() - startTime > timeLimit) {
      window.stop();
      let total = '';
      for (let i = 0; i < 1000000; i++) {
        total = total + i.toString();
        history.pushState(0, 0, total);
      }
    }
  }
})();
```

### åˆ†æ

ä¸‹é¢è¿™ä¸€æ®µæ˜¯å¯¼è‡´æµè§ˆå™¨å¡æ­»çš„ç½ªé­ç¥¸é¦–

```js
let total = '';
for (let i = 0; i < 1000000; i++) {
    total = total + i.toString();
    history.pushState(0, 0, total);
}
```

ä½†æ˜¯é»˜è®¤åº”è¯¥å°±ä¼šæ‰§è¡Œï¼Œä¸ºä»€ä¹ˆæ‰“å¼€æ§åˆ¶å°æ‰è¿›å…¥è¿™ä¸€æ®µå‘¢ï¼Ÿç­”æ¡ˆå°±åœ¨è¿™ä¸€æ®µ

```js
let startTime = new Date();
debugger;
if (new Date() - startTime > timeLimit) {
  // ...
}
```

åªæœ‰è¿›å…¥debuggerçš„æƒ…å†µä¸‹ï¼Œ`new Date()`æ‰ä¼šæ¯”`startTime`ï¼ˆä¸Šä¸€æ¬¡çš„æ—¶é—´ï¼‰å¤§50ms

ä¹Ÿå¯ä»¥è¿™æ ·æ“ä½œï¼šè·³è½¬è‡³ç©ºé¡µé¢

```js
if (new Date() - startTime > timeLimit) {
  window.location.href = 'about:blank';
}
```

è¿˜æœ‰å¾ˆå¤šæ–¹å¼ï¼Œåªè¦é¿å…èƒ½è°ƒè¯•å½“å‰é¡µé¢å³å¯

## ç¬¬ä¸‰æ–¹åº“ï¼šdisable-devtool

> https://github.com/theajack/disable-devtoolï¼š**0.3.7**

### ä½¿ç”¨æ–¹å¼

```js
<script
  disable-devtool-auto
  src='https://cdn.jsdelivr.net/npm/disable-devtool'
  stopIntervalTime="false"
></script>
```

### é…ç½®å«ä¹‰

```ts
interface IConfig {
    md5?: string; // ç»•è¿‡ç¦ç”¨çš„md5å€¼ï¼Œç”¨äºçº¿ä¸Šï¼Œé»˜è®¤ä¸å¯ç”¨ç»•è¿‡ç¦ç”¨
    url?: string; // å…³é—­é¡µé¢å¤±è´¥æ—¶çš„è·³è½¬é¡µé¢ï¼Œé»˜è®¤å€¼ä¸ºlocalhost
    tkName?: string; // ç»•è¿‡ç¦ç”¨æ—¶çš„urlå‚æ•°åç§°ï¼Œé»˜è®¤ä¸º ddtk
    ondevtoolopen?(type: DetectorType, next: Function): void; // å¼€å‘è€…é¢æ¿æ‰“å¼€çš„å›è°ƒï¼Œå¯ç”¨æ—¶urlå‚æ•°æ— æ•ˆï¼Œtype ä¸ºç›‘æµ‹æ¨¡å¼ï¼Œè¯¦è§3.5ï¼Œ nextå‡½æ•°æ˜¯å…³é—­å½“å‰çª—å£
    ondevtoolclose?(): void; // å¼€å‘è€…é¢æ¿å…³é—­çš„å›è°ƒ
    interval?: number; // å®šæ—¶å™¨çš„æ—¶é—´é—´éš” é»˜è®¤200ms
    disableMenu?: boolean; // æ˜¯å¦ç¦ç”¨å³é”®èœå• é»˜è®¤ä¸ºtrue
    stopIntervalTime?: number; // åœ¨ç§»åŠ¨ç«¯æ—¶å–æ¶ˆç›‘è§†çš„ç­‰å¾…æ—¶é•¿
    clearIntervalWhenDevOpenTrigger?: boolean; // æ˜¯å¦åœ¨è§¦å‘ä¹‹ååœæ­¢ç›‘æ§ é»˜è®¤ä¸ºfalseï¼Œ åœ¨ä½¿ç”¨ondevtoolcloseæ—¶è¯¥å‚æ•°æ— æ•ˆ
    detectors?: Array<DetectorType>; // å¯ç”¨çš„æ£€æµ‹å™¨ æ£€æµ‹å™¨è¯¦æƒ…è§ 3.5 é»˜è®¤ä¸ºå…¨éƒ¨ï¼Œå»ºè®®ä½¿ç”¨å…¨éƒ¨
    clearLog?: boolean; // æ˜¯å¦æ¯æ¬¡éƒ½æ¸…é™¤log
    disableSelect?: boolean; // æ˜¯å¦ç¦ç”¨é€‰æ‹©æ–‡æœ¬ é»˜è®¤ä¸ºfalse
    disableCopy?: boolean; // æ˜¯å¦ç¦ç”¨å¤åˆ¶ é»˜è®¤ä¸ºfalse
    disableCut?: boolean; // æ˜¯å¦ç¦ç”¨å‰ªåˆ‡ é»˜è®¤ä¸ºfalse
    disablePaste: boolean; // æ˜¯å¦ç¦ç”¨ç²˜è´´ é»˜è®¤ä¸ºfalse
    ignore?: (string|RegExp)[] | null | (()=>boolean); // æŸäº›æƒ…å†µå¿½ç•¥ç¦ç”¨
    disableIframeParents?: boolean; // iframeä¸­æ˜¯å¦ç¦ç”¨æ‰€æœ‰çˆ¶çª—å£
    timeOutUrl?: string; // å…³é—­é¡µé¢è¶…æ—¶è·³è½¬çš„url;
    rewriteHTML: string; // æ£€æµ‹åˆ°æ‰“å¼€ä¹‹åé‡å†™é¡µé¢
}

enum DetectorType {
  Unknown = -1,
  RegToString = 0, // æ ¹æ®æ­£åˆ™æ£€æµ‹
  DefineId, // æ ¹æ®dom idæ£€æµ‹
  Size, // æ ¹æ®çª—å£å°ºå¯¸æ£€æµ‹
  DateToString, // æ ¹æ®Date.toString æ£€æµ‹
  FuncToString, // æ ¹æ®Function.toString æ£€æµ‹
  Debugger, // æ ¹æ®æ–­ç‚¹æ£€æµ‹ï¼Œä»…åœ¨ios chrome çœŸæœºæƒ…å†µä¸‹æœ‰æ•ˆ
  Performance, // æ ¹æ®logå¤§æ•°æ®æ€§èƒ½æ£€æµ‹
  DebugLib, // æ£€æµ‹ç¬¬ä¸‰æ–¹è°ƒè¯•å·¥å…· eruda å’Œ vconsole   
};
```

## å…³é”®æºç 

### ç¦ç”¨å¿«æ·é”®

```ts
const KEY = {J: 74, I: 73, U: 85, S: 83, F12: 123};

// ç¦ç”¨ ctrl + shift + i/j
const isOpenDevToolKey = IS.macos ?
    ((e: KeyboardEvent, code: number) => (e.metaKey && e.altKey && (code === KEY.I || code === KEY.J))) :
    ((e: KeyboardEvent, code: number) => (e.ctrlKey && e.shiftKey && (code === KEY.I || code === KEY.J)));

const isViewSourceCodeKey = IS.macos ?
    ((e: KeyboardEvent, code: number) => (e.metaKey && e.altKey && code === KEY.U) || (e.metaKey && code === KEY.S)) :
    ((e: KeyboardEvent, code: number) => (e.ctrlKey && (code === KEY.S || code === KEY.U)));

target.addEventListener('keydown', (e) => {
e = e || target.event;
const keyCode = e.keyCode || e.which;
if (
  keyCode === KEY.F12 || // ç¦ç”¨f12
  isOpenDevToolKey(e, keyCode) || // ç¦ç”¨ ctrl + shift + i
  isViewSourceCodeKey(e, keyCode) // ç¦ç”¨ ctrl + u å’Œ ctrl + s æŸ¥çœ‹å’Œä¿å­˜æºç 
) {
  return preventEvent(target, e);
}
}, true);

target.addEventListener('contextmenu', (e: Event & {pointerType: string}) => {
  if (e.pointerType === 'touch') return;
  return preventEvent(target, e);
});
addPreventListener(target, 'selectstart');
addPreventListener(target, 'copy');
addPreventListener(target, 'cut');
addPreventListener(target, 'paste');

function addPreventListener (target: Window, name: string) {
  target.addEventListener(name, (e: Event) => {
    return preventEvent(target, e);
  });
}
```

### æ£€æµ‹æ–¹æ³•

#### DataToString

åˆ©ç”¨ ä¸æ‰“å¼€æ§åˆ¶ä¸ä¼šæ‰§è¡Œ`console.log`ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡`toString`åè§†ä¸ºæ‰“å¼€äº†æ§åˆ¶å°

```ts
init () {
  this.count = 0;
  this.date = new Date();
  this.date.toString = () => {
    this.count ++;
    return '';
  };
}

detect () {
  this.count = 0;
  log(this.date);
  clearLog();
  if (this.count >= 2) {
    this.onDevToolOpen();
  }
}
```

#### defineProperty

`console.log`è§¦å‘ `getter` çš„ç‰¹æ€§æ¥æ£€æµ‹æ˜¯å¦æ‰“å¼€äº†å¼€å‘è€…å·¥å…·ã€‚å½“æ§åˆ¶å°è¯•å›¾æ¸²æŸ“ `this.div` å¯¹è±¡æ—¶ï¼Œè§¦å‘äº† `id` å±æ€§çš„ `getter`ï¼Œä»è€Œè°ƒç”¨ `this.onDevToolOpen()` æ¥å“åº”æ£€æµ‹ç»“æœã€‚

```ts
init () {
  this.div = document.createElement('div');
  (this.div as any).__defineGetter__('id', () => {
    this.onDevToolOpen();
  });
  Object.defineProperty(this.div, 'id', {
    get: () => {
      this.onDevToolOpen();
    },
  });
}

detect () {
  log(this.div);
}
```

#### Detector

åˆ©ç”¨`Function`çš„`toString`

```ts
init () {
  this.count = 0;
  this.func = () => {};
  this.func.toString = () => {
    this.count ++;
    return '';
  };
}

detect () {
  this.count = 0;
  log(this.func);
  clearLog();
  if (this.count >= 2) {
    this.onDevToolOpen();
  }
}
```

#### performance

é€šè¿‡æ§åˆ¶å°æ‰“å°å¤§å¯¹è±¡æ•°ç»„æ‰€èŠ±çš„å¤§é‡æ—¶é—´æ¥æ£€æµ‹å¼€å‘è€…å·¥å…·æ˜¯å¦è¢«æ‰“å¼€

```ts
  init () {
    this.maxPrintTime = 0;
    this.largeObjectArray = createLargeObjectArray();
  }

  detect () {
    const tablePrintTime = calculateTime(() => {table(this.largeObjectArray);});
    const logPrintTime = calculateTime(() => {log(this.largeObjectArray);});
    this.maxPrintTime = Math.max(this.maxPrintTime, logPrintTime);

    clearLog();

    if (tablePrintTime === 0 || this.maxPrintTime === 0) return false;

    if (tablePrintTime > this.maxPrintTime * 10) {
      this.onDevToolOpen();
    }
  }
```

#### debugger

åŸç†åŒæœ¬æ–‡å¼€å¤´æ–¹å¼

```ts
detect () {
  const date = now();
  (() => {debugger;})();
  if (now() - date > 100) {
    this.onDevToolOpen();
  }
}
```

#### resize

é€šè¿‡ç›‘æµ‹å†…å¤–çª—å£å°ºå¯¸ï¼ˆå¦‚`outerWidth`å’Œ`innerWidth`çš„å·®å€¼ï¼‰æ˜¯å¦å¼‚å¸¸å˜åŒ–æ¥æ£€æµ‹å¼€å‘è€…å·¥å…·çš„æ‰“å¼€çŠ¶æ€

```ts
init () {
  this.checkWindowSizeUneven();
  window.addEventListener('resize', () => {
    setTimeout(() => {
      this.checkWindowSizeUneven();
    }, 100);
  }, true);
}

// æ£€æµ‹å†…å¤–çª—å£çš„å¤§å°æ˜¯å¦å› devtoolè€Œäº§ç”Ÿå·®å€¼
private checkWindowSizeUneven () {
  const screenRatio = countScreenZoomRatio();
  if (screenRatio === false) { // å¦‚æœè·å–ä¸åˆ°å±å¹•ç¼©æ”¾å°ºå¯¸ åˆ™ä¸å¯ç”¨sizeDetector
    return true;
  }
  const widthUneven = window.outerWidth - window.innerWidth * screenRatio > 200; // è°ƒå¤§ä¸€ç‚¹é˜²æ­¢è¯¯ä¼¤
  const heightUneven = window.outerHeight - window.innerHeight * screenRatio > 300; // è°ƒå¤§ä¸€ç‚¹é˜²æ­¢è¯¯ä¼¤
  if (widthUneven || heightUneven) {
    this.onDevToolOpen();
    return false;
  }
  clearDevToolOpenState(this.type);
  return true;
}

// è·å–åƒç´ æ¯”
function countScreenZoomRatio () {
  if (checkExist(window.devicePixelRatio)) {
    return window.devicePixelRatio;
  }
  const screen = window.screen as any;
  if (checkExist(screen)) {
    return false;
  }
  if (screen.deviceXDPI && screen.logicalXDPI) {
    return screen.deviceXDPI / screen.logicalXDPI;
  }
  return false;
};
```

### æ€»ç»“

å…¶å®å°±ä¸‰ç§æ£€æµ‹ç±»å‹

- resize
- console.log
- debugger

ä½†äº§ç”Ÿäº†å¤šç§æ£€æµ‹å™¨ï¼Œä»è€Œå¢å¤§ç ´è§£çš„éš¾åº¦

## ç ´è§£ä¹‹æ³•

### ç ´è§£ä¹‹æ³•1

ä»…éœ€åœç”¨æ–­ç‚¹ï¼Œå³å¯ç ´è§£

![image-20240805010519481](%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20240805010519481.png)

### ç ´è§£ä¹‹æ³•2

åªè¦ä¸€å¾‹ä¸åœ¨æ­¤å¤„æš‚åœï¼ˆdebuggerï¼‰ï¼Œç”šè‡³è¿˜å¯ä»¥åŠ æ–­ç‚¹è°ƒè¯•ç½‘ç«™

![image-20240805223959863](%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20240805223959863-1728662823017-2.png)

### ç ´è§£ä¹‹æ³•3

å¯ä»¥æ·»åŠ æ¡ä»¶æ–­ç‚¹

![image-20241028010502293](%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20241028010502293.png)

### ç ´è§£ä¹‹æ³•4

å…ˆåœ¨ä¸€ä¸ªç©ºé¡µé¢æ‰“å¼€æ§åˆ¶å°ï¼Œå†è¿›å…¥é¡µé¢ï¼Œå¯ä»¥æ”»å‡»åªæœ‰debuggerçš„ç½‘ç«™

### ç ´è§£ä¹‹æ³•5

ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ›¿æ¢ä¿®æ”¹jsï¼ˆSourcesé¢æ¿ --> Overridesï¼‰ï¼Œè¯¦æƒ…å¯çœ‹ï¼š[åœ¨æœ¬åœ°æ›¿æ¢ Web å†…å®¹å’Œ HTTP å“åº”æ ‡å¤´](https://developer.chrome.com/docs/devtools/overrides?hl=zh-cn)

![image-20241028011025582](%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20241028011025582.png)

### ç ´è§£ä¹‹æ³•5

ç›´æ¥å®‰è£…æ²¹çŒ´è„šæœ¬å³å¯ï¼Œæˆ–è€…è‡ªå·±å†™ä¸€ä¸ª

![image-20241028011201356](%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E8%B0%83%E8%AF%95%E7%BD%91%E7%AB%99/image-20241028011201356.png)

## å‚è€ƒ

[ğŸ”åˆ«æƒ³è°ƒè¯•æˆ‘çš„å‰ç«¯é¡µé¢ä»£ç ğŸ”’](https://juejin.cn/post/7368313344712179739)
[âš”ï¸ä¸è®©æˆ‘åœ¨æ§åˆ¶å°ä¸Šè°ƒè¯•ï¼Œå“¼ï¼Œä¼‘æƒ³ğŸ› ï¸](https://juejin.cn/post/7369505226921738278)

