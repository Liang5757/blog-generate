---
title: æµ…å†™ä¸€ä¸‹è„šæ‰‹æ¶
date: 2025-12-11 22:48:03
tags:
  - node.js
categories:
  - å‰ç«¯å·¥ç¨‹åŒ–
---

åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œè„šæ‰‹æ¶ï¼ˆCLI å·¥å…·ï¼‰å·²ç»æˆä¸ºä¸å¯æˆ–ç¼ºçš„å¼€å‘å·¥å…·ã€‚æ— è®ºæ˜¯ Vue CLIã€Create React App è¿˜æ˜¯ Angular CLIï¼Œå®ƒä»¬éƒ½èƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»ºé¡¹ç›®ç»“æ„ã€ç»Ÿä¸€å›¢é˜Ÿè§„èŒƒã€æé«˜å¼€å‘æ•ˆç‡ã€‚

æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Node.js è„šæ‰‹æ¶ï¼Œæ¶µç›–å‘½ä»¤è¡Œè§£æã€ç”¨æˆ·äº¤äº’ã€æ¨¡æ¿ä¸‹è½½ã€æ–‡ä»¶æ“ä½œç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•å¼€å‘ä¸€ä¸ªç±»ä¼¼ Vue CLI çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶èƒ½å°†å…¶å‘å¸ƒåˆ° npm ä¾›ä»–äººä½¿ç”¨ã€‚

è®©æˆ‘ä»¬å¼€å§‹å§ï¼
<!--more-->

## å¤„ç†ç”¨æˆ·å‘½ä»¤

æˆ‘ä»¬æœŸæœ›èƒ½åƒ Vue CLI ä¸€æ ·ï¼Œç”¨ `vue create xxx` å‘½ä»¤å°±èƒ½åˆ›å»ºä¸€ä¸ª Vue é¡¹ç›®

ä¸ºäº†èƒ½å¤Ÿè§£æç”¨æˆ·å‘½ä»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† [commander.js](https://github.com/tj/commander.js) åº“ã€‚

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè·¯å¾„ä¸º `./bin/index.js`

```javascript
#! /usr/bin/env node
const { program } = require('commander');
const create = require('../script/create.js');

program
  .command('create <name>')
  .description('åˆ›å»ºé¡¹ç›®')
  .action(name => {
    create(name);
  });

program.parse();
```

å¿…é¡»è¦åŠ ç¬¬ä¸€è¡Œ `#! /usr/bin/env node`ï¼Œå°†æ‰§è¡Œç¯å¢ƒè®¾ç½®ä¸º nodeï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š[ç›¸å…³ StackOverflow è®¨è®º](https://stackoverflow.com/questions/39585342/node-when-i-run-package-json-bin-command-give-me-syntax-error-near-unexp)

ç„¶ååœ¨ package.json ä¸­å¢åŠ å¦‚ä¸‹é…ç½®

```json
"bin": {
  "op": "./bin/index.js"
},
```

æœ€åæ‰§è¡Œ `npm link`ï¼Œå°† bin ä¸­çš„ op å‘½ä»¤æ³¨å†Œæˆå…¨å±€å‘½ä»¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `op create` å‘½ä»¤å•¦

## æ”¯æŒæŸ¥çœ‹ç‰ˆæœ¬

è¯»å–æœ¬åœ° package.json ä¸­çš„ version å­—æ®µ

```javascript
const packageJson = require('../package.json');

program.version(packageJson.version, '-v, --version');
```

## äº¤äº’å¼å‘½ä»¤è¡Œï¼ˆinquirerï¼‰

å¦‚æœä¸æ»¡è¶³äº commander.js åœ¨ä¸€è¡Œå†…æ‹¼æ¥å¤§é‡å‚æ•°çš„å½¢å¼ï¼ˆå¼€å‘è€…ä¹Ÿéš¾ä»¥è®°ä½å¤æ‚çš„å‚æ•°ç”¨æ³•ï¼‰ï¼Œå¯ä»¥ç”¨ [Inquirer.js](https://github.com/SBoudrias/Inquirer.js) æ¥åšåˆ°äº¤äº’å¼çš„å‘½ä»¤è¡Œã€‚

```javascript
const inquirer = require('inquirer');

inquirer.prompt([
  {
    name: 'vue',
    // å¤šé€‰äº¤äº’åŠŸèƒ½
    // å•é€‰å°†è¿™é‡Œä¿®æ”¹ä¸º list å³å¯
    type: 'checkbox',
    message: 'Check the features needed for your project:',
    choices: [
      {
        name: 'Babel',
        checked: true,
      },
      {
        name: 'TypeScript',
      },
      {
        name: 'Progressive Web App (PWA) Support',
      },
      {
        name: 'Router',
      },
    ],
  },
]).then((data) => {
  console.log(data);
});
```

**æ•ˆæœå±•ç¤ºï¼š**

![äº¤äº’å¼å‘½ä»¤è¡Œæ•ˆæœ](æµ…å†™ä¸€ä¸‹è„šæ‰‹æ¶/inquirer-demo.png)

## å‘½ä»¤è¡Œ loading æ•ˆæœï¼ˆoraï¼‰

åœ¨è„šæ‰‹æ¶æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆå¦‚ä¸‹è½½æ¨¡æ¿ã€å®‰è£…ä¾èµ–ï¼‰æ—¶ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºä¸€ä¸ª loading åŠ¨ç”»ï¼Œè®©ç”¨æˆ·çŸ¥é“ç¨‹åºæ­£åœ¨è¿è¡Œä¸­ã€‚[ora](https://github.com/sindresorhus/ora) å°±æ˜¯ä¸“é—¨ç”¨æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„åº“ã€‚

å®‰è£… oraï¼š

```bash
npm install ora
```

å®é™…åº”ç”¨ç¤ºä¾‹ï¼š

```javascript
const ora = require('ora');
const download = require('download-git-repo');

async function downloadTemplate(repo, dest) {
  const spinner = ora('æ­£åœ¨ä¸‹è½½é¡¹ç›®æ¨¡æ¿...').start();

  return new Promise((resolve, reject) => {
    download(repo, dest, { clone: false }, (err) => {
      if (err) {
        spinner.fail('æ¨¡æ¿ä¸‹è½½å¤±è´¥');  // å¤±è´¥çŠ¶æ€ï¼ˆçº¢è‰² âœ–ï¼‰
        reject(err);
      } else {
        spinner.succeed('æ¨¡æ¿ä¸‹è½½æˆåŠŸ');  // æˆåŠŸçŠ¶æ€ï¼ˆç»¿è‰² âœ”ï¼‰
        resolve();
      }
    });
  });
}
```

ora è¿˜æ”¯æŒå…¶ä»–çŠ¶æ€ï¼š`warn()` è­¦å‘Šï¼ˆé»„è‰² âš ï¼‰ã€`info()` ä¿¡æ¯ï¼ˆè“è‰² â„¹ï¼‰

**æ•ˆæœå±•ç¤ºï¼š**

![loading æ•ˆæœ](æµ…å†™ä¸€ä¸‹è„šæ‰‹æ¶/ora-demo.png)

## æ‰§è¡Œå‘½ä»¤

åœ¨è„šæ‰‹æ¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ‰§è¡Œä¸€äº› shell å‘½ä»¤ï¼Œæ¯”å¦‚ `git clone` ä¸‹è½½æ¨¡æ¿ã€`npm install` å®‰è£…ä¾èµ–ç­‰ã€‚Node.js æä¾›äº† `child_process` æ¨¡å—æ¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼Œä½†æˆ‘ä»¬æ›´æ¨èä½¿ç”¨ [execa](https://github.com/sindresorhus/execa)ï¼Œå®ƒæ˜¯ `child_process` çš„å¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¥½çš„ API å’Œé”™è¯¯å¤„ç†ã€‚

å®‰è£… execaï¼š

```bash
npm install execa
```

å®é™…åº”ç”¨ç¤ºä¾‹ï¼š

```javascript
const execa = require('execa');
const ora = require('ora');

// å®‰è£…ä¾èµ–
async function installDependencies(projectName) {
  const spinner = ora('æ­£åœ¨å®‰è£…ä¾èµ–...').start();
  try {
    await execa('npm', ['install'], { cwd: projectName });
    spinner.succeed('ä¾èµ–å®‰è£…æˆåŠŸ');
  } catch (error) {
    spinner.fail('ä¾èµ–å®‰è£…å¤±è´¥');
    throw error;
  }
}
```

**æ³¨æ„**ï¼šå¦‚æœä½¿ç”¨ CommonJS (`require`)ï¼Œéœ€è¦å®‰è£… execa v5 ç‰ˆæœ¬ï¼š`npm install execa@5`ã€‚execa v6+ ä»…æ”¯æŒ ESM æ¨¡å—ã€‚

### execa ä¸å…¶ä»–å·¥å…·å¯¹æ¯”

| ç‰¹æ€§ | child_process | shelljs | execa |
|------|--------------|---------|-------|
| **API é£æ ¼** | å›è°ƒ/äº‹ä»¶ | åŒæ­¥ | Promise/Async |
| **é”™è¯¯å¤„ç†** | éœ€æ‰‹åŠ¨å¤„ç† | ç®€å• | å®Œå–„ï¼ŒåŒ…å« stdout/stderr |
| **è·¨å¹³å°æ”¯æŒ** | éœ€æ‰‹åŠ¨å¤„ç† | è‰¯å¥½ | ä¼˜ç§€ |
| **è¾“å‡ºå¤„ç†** | éœ€æ‰‹åŠ¨æ‹¼æ¥ | ç›´æ¥è¿”å› | è‡ªåŠ¨æ¸…ç†å’Œæ ¼å¼åŒ– |
| **è¶…æ—¶æ§åˆ¶** | éœ€æ‰‹åŠ¨å®ç° | ä¸æ”¯æŒ | åŸç”Ÿæ”¯æŒ |
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ | å¹³ç¼“ | å¹³ç¼“ |
| **æ€§èƒ½** | é«˜ | ä¸­ç­‰ | é«˜ |
| **é€‚ç”¨åœºæ™¯** | å¤æ‚åœºæ™¯ | ç®€å•è„šæœ¬ | ç°ä»£ Node.js é¡¹ç›® |

æ¨èä½¿ç”¨ execa çš„ç†ç”±ï¼š
- ç°ä»£åŒ–çš„ Promise APIï¼Œé…åˆ async/await ä½¿ç”¨æ›´ä¼˜é›…
- æ›´å¥½çš„é”™è¯¯ä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´çš„å‘½ä»¤ã€é€€å‡ºç å’Œè¾“å‡º
- å¼€ç®±å³ç”¨çš„è·¨å¹³å°æ”¯æŒï¼Œæ— éœ€æ‹…å¿ƒ Windows å…¼å®¹æ€§
- æ´»è·ƒç»´æŠ¤ï¼Œç¤¾åŒºæ”¯æŒè‰¯å¥½

## äº”é¢œå…­è‰²çš„å‘½ä»¤è¡Œ

ä¸ºäº†è®©å‘½ä»¤è¡Œè¾“å‡ºæ›´åŠ ç›´è§‚å’Œç¾è§‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [chalk](https://github.com/chalk/chalk) åº“ä¸ºæ–‡æœ¬æ·»åŠ é¢œè‰²å’Œæ ·å¼ã€‚ä¸åŒçš„é¢œè‰²å¯ä»¥è¡¨ç¤ºä¸åŒçš„çŠ¶æ€ï¼šæˆåŠŸç”¨ç»¿è‰²ã€å¤±è´¥ç”¨çº¢è‰²ã€è­¦å‘Šç”¨é»„è‰²ç­‰ã€‚

å®‰è£… chalkï¼š

```bash
npm install chalk
```

å®é™…åº”ç”¨ç¤ºä¾‹ï¼š

```javascript
const chalk = require('chalk');

// ä¸åŒçŠ¶æ€çš„è¾“å‡º
console.log(chalk.green('âœ” æ“ä½œæˆåŠŸ'));
console.log(chalk.red('âœ– æ“ä½œå¤±è´¥'));
console.log(chalk.yellow('âš  è­¦å‘Šä¿¡æ¯'));
console.log(chalk.blue('â„¹ æç¤ºä¿¡æ¯'));

// ç»„åˆæ ·å¼
console.log(chalk.bold.blue('ğŸš€ å¼€å§‹åˆ›å»ºé¡¹ç›®'));
console.log(chalk.bold.green('âœ¨ é¡¹ç›®åˆ›å»ºæˆåŠŸï¼'));

// èƒŒæ™¯è‰²
console.log(chalk.bgGreen.black(' SUCCESS '));
console.log(chalk.bgRed.white(' ERROR '));
```

å¸¸ç”¨é¢œè‰²ï¼š`green` æˆåŠŸã€`red` å¤±è´¥ã€`yellow` è­¦å‘Šã€`blue` æç¤ºã€`gray` æ¬¡è¦ä¿¡æ¯ã€‚å¯ä»¥ç»„åˆä½¿ç”¨ï¼š`chalk.bold.green()` åŠ ç²—ç»¿è‰²ã€`chalk.bgGreen.black()` ç»¿è‰²èƒŒæ™¯é»‘è‰²æ–‡å­—ã€‚

**æ•ˆæœå±•ç¤ºï¼š**

![å½©è‰²å‘½ä»¤è¡Œæ•ˆæœ](æµ…å†™ä¸€ä¸‹è„šæ‰‹æ¶/chalk-demo.png)

## ä¸‹è½½æ¨¡æ¿

ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº†å‘½ä»¤è¡Œçš„åŸºç¡€èƒ½åŠ›ï¼Œæ¥ä¸‹æ¥å®ç°è„šæ‰‹æ¶çš„æ ¸å¿ƒåŠŸèƒ½ â€”â€” ä» Git ä»“åº“ä¸‹è½½é¡¹ç›®æ¨¡æ¿ã€‚[download-git-repo](https://github.com/flipxfx/download-git-repo) æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºä¸‹è½½ Git ä»“åº“çš„åº“ã€‚

å®‰è£…ä¾èµ–ï¼š

```bash
npm install download-git-repo
```

å®é™…åº”ç”¨ç¤ºä¾‹ï¼ˆè®©ç”¨æˆ·é€‰æ‹©æ¨¡æ¿ï¼‰ï¼š

```javascript
const inquirer = require('inquirer');
const download = require('download-git-repo');
const ora = require('ora');
const chalk = require('chalk');

// æ¨¡æ¿åˆ—è¡¨
const templates = {
  'Vue 3': 'github:vuejs/create-vue',
  'React': 'github:facebook/create-react-app',
  'Vue 2': 'github:vuejs/vue'
};

async function create(projectName) {
  // 1. è®©ç”¨æˆ·é€‰æ‹©æ¨¡æ¿
  const { template } = await inquirer.prompt([
    {
      name: 'template',
      type: 'list',
      message: 'è¯·é€‰æ‹©é¡¹ç›®æ¨¡æ¿:',
      choices: ['Vue 3', 'React', 'Vue 2']
    }
  ]);

  // 2. ä¸‹è½½æ¨¡æ¿
  const spinner = ora('æ­£åœ¨ä¸‹è½½æ¨¡æ¿...').start();
  try {
    await new Promise((resolve, reject) => {
      download(templates[template], projectName, { clone: false }, (err) => {
        if (err) reject(err);
        else resolve();
      });
    });
    spinner.succeed(chalk.green('æ¨¡æ¿ä¸‹è½½æˆåŠŸ'));
  } catch (error) {
    spinner.fail(chalk.red('æ¨¡æ¿ä¸‹è½½å¤±è´¥'));
    throw error;
  }
}
```

**æ”¯æŒçš„ Git å¹³å°æ ¼å¼ï¼š**
- GitHub: `github:user/repo`
- GitLab: `gitlab:user/repo`
- Gitee: `gitee:user/repo`
- æŒ‡å®šåˆ†æ”¯: `github:user/repo#branch-name`

## æ–‡ä»¶æ“ä½œ

ä¸‹è½½å®Œæ¨¡æ¿åï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œä¸€äº›æ“ä½œï¼šå¤åˆ¶æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ã€åˆ›å»ºç›®å½•ç­‰ã€‚Node.js åŸç”Ÿçš„ `fs` æ¨¡å—è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½† API æ¯”è¾ƒåŸå§‹ã€‚[fs-extra](https://github.com/jprichardson/node-fs-extra) æ˜¯ `fs` çš„å¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šå®ç”¨çš„æ–¹æ³•ã€‚

å®‰è£… fs-extraï¼š

```bash
npm install fs-extra
```

**å¸¸ç”¨ APIï¼š**
- `fs.copy(src, dest)` - å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•
- `fs.remove(path)` - åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•
- `fs.ensureDir(path)` - ç¡®ä¿ç›®å½•å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
- `fs.readJson(file)` / `fs.writeJson(file, obj)` - è¯»å†™ JSON æ–‡ä»¶
- `fs.pathExists(path)` - æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨

å®é™…åº”ç”¨ç¤ºä¾‹ï¼š

```javascript
const fs = require('fs-extra');
const path = require('path');
const chalk = require('chalk');

async function setupProject(projectName) {
  // 1. æ‰¹é‡åˆ›å»ºç›®å½•ç»“æ„
  const dirs = ['src', 'src/components', 'src/utils', 'public', 'tests'];
  for (const dir of dirs) {
    await fs.ensureDir(path.join(projectName, dir));
  }

  // 2. åˆ é™¤æ¨¡æ¿ä¸­çš„ .git ç›®å½•
  const gitDir = path.join(projectName, '.git');
  if (await fs.pathExists(gitDir)) {
    await fs.remove(gitDir);
  }

  // 3. å¤åˆ¶é…ç½®æ–‡ä»¶
  await fs.copy('template/config', path.join(projectName, 'config'));

  console.log(chalk.green('âœ” é¡¹ç›®ç»“æ„åˆ›å»ºå®Œæˆ'));
}
```

## åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ `package.json`ã€`.eslintrc` ç­‰ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¥å®ç°ã€‚[ejs](https://github.com/mde/ejs) æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ¨¡æ¿å¼•æ“ã€‚

å®‰è£… ejsï¼š

```bash
npm install ejs
```

å®é™…åº”ç”¨ç¤ºä¾‹ï¼š

**1. åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ `package.json.ejs`ï¼š**

```json
{
  "name": "<%= projectName %>",
  "version": "1.0.0",
  "description": "<%= description %>",
  "author": "<%= author %>",
  "dependencies": {
    "vue": "^3.3.0"
    <% if (useRouter) { %>,
    "vue-router": "^4.2.0"
    <% } %>
  }
}
```

**2. ä½¿ç”¨ ejs æ¸²æŸ“æ¨¡æ¿ï¼š**

```javascript
const inquirer = require('inquirer');
const ejs = require('ejs');
const fs = require('fs-extra');
const path = require('path');
const chalk = require('chalk');

async function create(projectName) {
  // æ”¶é›†ç”¨æˆ·ä¿¡æ¯
  const answers = await inquirer.prompt([
    { name: 'description', message: 'è¯·è¾“å…¥é¡¹ç›®æè¿°:', default: 'A new project' },
    { name: 'author', message: 'è¯·è¾“å…¥ä½œè€…åç§°:', default: 'Your Name' },
    {
      name: 'features',
      type: 'checkbox',
      message: 'è¯·é€‰æ‹©é¡¹ç›®ç‰¹æ€§:',
      choices: [
        { name: 'TypeScript', value: 'typescript' },
        { name: 'Vue Router', value: 'router' }
      ]
    }
  ]);

  // ç”Ÿæˆ package.json
  const template = await fs.readFile('./templates/package.json.ejs', 'utf-8');
  const content = ejs.render(template, {
    projectName,
    description: answers.description,
    author: answers.author,
    useRouter: answers.features.includes('router')
  });

  await fs.writeFile(path.join(projectName, 'package.json'), content);
  console.log(chalk.green('âœ” é…ç½®æ–‡ä»¶ç”ŸæˆæˆåŠŸ'));
}
```

## è‡ªåŠ¨å®‰è£…ä¾èµ–

é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œè‡ªåŠ¨å®‰è£…ä¾èµ–å¯ä»¥å¤§å¤§æå‡ç”¨æˆ·ä½“éªŒã€‚æˆ‘ä»¬éœ€è¦æ£€æµ‹ç”¨æˆ·ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼ˆnpm/yarn/pnpmï¼‰ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å®‰è£…å‘½ä»¤ã€‚

å®é™…åº”ç”¨ç¤ºä¾‹ï¼š

```javascript
const inquirer = require('inquirer');
const execa = require('execa');
const ora = require('ora');
const chalk = require('chalk');
const download = require('download-git-repo');

// æ¨¡æ¿æ˜ å°„
const templates = {
  'Vue 3': 'github:vuejs/create-vue',
  'React': 'github:facebook/create-react-app',
  'Vue 2': 'github:vuejs/vue'
};

// ä¸‹è½½æ¨¡æ¿å‡½æ•°
function downloadTemplate(template, projectName) {
  return new Promise((resolve, reject) => {
    download(templates[template], projectName, { clone: false }, (err) => {
      if (err) reject(err);
      else resolve();
    });
  });
}

// æ£€æµ‹åŒ…ç®¡ç†å™¨
async function getPackageManager() {
  try {
    await execa('pnpm', ['--version']);
    return 'pnpm';
  } catch (e) {
    try {
      await execa('yarn', ['--version']);
      return 'yarn';
    } catch (e) {
      return 'npm';
    }
  }
}

// å®Œæ•´çš„åˆ›å»ºæµç¨‹
async function create(projectName) {
  console.log(chalk.bold.blue(`\nğŸš€ å¼€å§‹åˆ›å»ºé¡¹ç›®: ${projectName}\n`));

  try {
    // 1. ç”¨æˆ·é€‰æ‹©
    const answers = await inquirer.prompt([
      {
        name: 'template',
        type: 'list',
        message: 'è¯·é€‰æ‹©é¡¹ç›®æ¨¡æ¿:',
        choices: ['Vue 3', 'React', 'Vue 2']
      },
      {
        name: 'installDeps',
        type: 'confirm',
        message: 'æ˜¯å¦è‡ªåŠ¨å®‰è£…ä¾èµ–?',
        default: true
      }
    ]);

    // 2. ä¸‹è½½æ¨¡æ¿
    const spinner = ora('æ­£åœ¨ä¸‹è½½æ¨¡æ¿...').start();
    await downloadTemplate(answers.template, projectName);
    spinner.succeed(chalk.green('æ¨¡æ¿ä¸‹è½½æˆåŠŸ'));

    // 3. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœç”¨æˆ·é€‰æ‹©ï¼‰
    if (answers.installDeps) {
      const pm = await getPackageManager();
      const installSpinner = ora('æ­£åœ¨å®‰è£…ä¾èµ–...').start();
      try {
        await execa(pm, ['install'], { cwd: projectName, stdio: 'inherit' });
        installSpinner.succeed(chalk.green('ä¾èµ–å®‰è£…æˆåŠŸ'));
      } catch (error) {
        installSpinner.fail(chalk.red('ä¾èµ–å®‰è£…å¤±è´¥'));
      }
    }

    // 4. å®Œæˆæç¤º
    console.log(chalk.bold.green(`\nâœ¨ é¡¹ç›® ${projectName} åˆ›å»ºæˆåŠŸï¼\n`));
    console.log(chalk.cyan('å¼€å§‹å¼€å‘:'));
    console.log(chalk.gray(`  cd ${projectName}`));
    console.log(chalk.gray(`  npm run dev\n`));
  } catch (error) {
    console.log(chalk.red(`\nåˆ›å»ºå¤±è´¥: ${error.message}\n`));
  }
}
```

**å®Œæ•´æµç¨‹æ•ˆæœå±•ç¤ºï¼š**

![è„šæ‰‹æ¶å®Œæ•´åˆ›å»ºæµç¨‹](æµ…å†™ä¸€ä¸‹è„šæ‰‹æ¶/complete-flow-demo.png)

## æ€»ç»“

é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Node.js è„šæ‰‹æ¶å·¥å…·ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ¶‰åŠçš„æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š

**æ ¸å¿ƒä¾èµ–åº“ï¼š**
- **commander.js** - å‘½ä»¤è¡Œå‚æ•°è§£æ
- **inquirer.js** - äº¤äº’å¼å‘½ä»¤è¡Œ
- **ora** - å‘½ä»¤è¡Œ loading æ•ˆæœ
- **chalk** - å‘½ä»¤è¡Œæ–‡å­—é¢œè‰²
- **execa** - æ‰§è¡Œ shell å‘½ä»¤
- **download-git-repo** - ä¸‹è½½ Git ä»“åº“
- **fs-extra** - å¢å¼ºçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- **ejs** - æ¨¡æ¿å¼•æ“

**é‡è¦æç¤º**ï¼šæœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹ä½¿ç”¨ CommonJS æ¨¡å—ç³»ç»Ÿï¼ˆ`require`/`module.exports`ï¼‰ã€‚éƒ¨åˆ†åº“çš„è¾ƒæ–°ç‰ˆæœ¬ï¼ˆv6+ï¼‰ä»…æ”¯æŒ ESMï¼Œå¦‚éœ€ä½¿ç”¨è¯·å®‰è£…æŒ‡å®šç‰ˆæœ¬æˆ–æ”¹ç”¨ ESM æ¨¡å—ç³»ç»Ÿã€‚

**å®Œæ•´å¼€å‘æµç¨‹ï¼š**
1. ä½¿ç”¨ commander å¤„ç†ç”¨æˆ·å‘½ä»¤
2. ä½¿ç”¨ inquirer å®ç°äº¤äº’å¼é€‰é¡¹
3. ä½¿ç”¨ ora å’Œ chalk ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
4. ä½¿ç”¨ download-git-repo ä¸‹è½½é¡¹ç›®æ¨¡æ¿
5. ä½¿ç”¨ fs-extra è¿›è¡Œæ–‡ä»¶æ“ä½œ
6. ä½¿ç”¨ ejs åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶
7. ä½¿ç”¨ execa è‡ªåŠ¨å®‰è£…ä¾èµ–
8. å‘å¸ƒåˆ° npm ä¾›ä»–äººä½¿ç”¨

**è¿›é˜¶æ–¹å‘ï¼š**
- **æ’ä»¶ç³»ç»Ÿ** - æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶æ‰©å±•åŠŸèƒ½
- **é…ç½®æ–‡ä»¶** - æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰è„šæ‰‹æ¶è¡Œä¸º
- **æ›´æ–°æ£€æŸ¥** - æ£€æµ‹è„šæ‰‹æ¶æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
- **æ¨¡æ¿ç®¡ç†** - æ”¯æŒæ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢å¤šä¸ªæ¨¡æ¿
- **å•å…ƒæµ‹è¯•** - ä½¿ç”¨ Jest ç­‰å·¥å…·ç¼–å†™æµ‹è¯•ç”¨ä¾‹
- **CI/CD** - é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å’Œå‘å¸ƒæµç¨‹

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ ç†è§£è„šæ‰‹æ¶çš„å®ç°åŸç†ï¼Œå¹¶åŠ¨æ‰‹å¼€å‘å‡ºå±äºè‡ªå·±çš„å‘½ä»¤è¡Œå·¥å…·ï¼

## å¸¸è§é—®é¢˜è§£ç­”

### 1. ä¸ºä»€ä¹ˆè¿è¡Œ `npm link` åå‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ

**é—®é¢˜**ï¼šæ‰§è¡Œ `npm link` åï¼Œåœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤æç¤º "command not found"ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `package.json` ä¸­ `bin` å­—æ®µé…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ `bin` æŒ‡å‘çš„æ–‡ä»¶ç¬¬ä¸€è¡Œæœ‰ `#! /usr/bin/env node`
- Windows ç”¨æˆ·å¯èƒ½éœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ `npm link`
- å°è¯•é‡æ–°æ‰“å¼€ç»ˆç«¯æˆ–æ‰§è¡Œ `npm unlink` åå†æ¬¡ `npm link`

### 2. ä½¿ç”¨ `require('execa')` æŠ¥é”™æ€ä¹ˆåŠï¼Ÿ

**é—®é¢˜**ï¼šæç¤º "Cannot find module 'execa'" æˆ– "require() of ES Module not supported"ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ1ï¼šå®‰è£…æ”¯æŒ CommonJS çš„ç‰ˆæœ¬
npm install execa@5

# æ–¹æ¡ˆ2ï¼šæ”¹ç”¨ ESM æ¨¡å—ç³»ç»Ÿ
# ä¿®æ”¹ package.json æ·»åŠ  "type": "module"
# å°†æ‰€æœ‰ require æ”¹ä¸º import
```

### 3. ä¸‹è½½æ¨¡æ¿æ—¶ä¸€ç›´å¡ä½æˆ–å¤±è´¥ï¼Ÿ

**é—®é¢˜**ï¼šæ‰§è¡Œ `download-git-repo` ä¸‹è½½æ¨¡æ¿æ—¶é•¿æ—¶é—´æ— å“åº”æˆ–æŠ¥ç½‘ç»œé”™è¯¯ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ŒGitHub è®¿é—®å¯èƒ½éœ€è¦ä»£ç†
- ä½¿ç”¨å›½å†…é•œåƒæˆ– Gitee ä»“åº“ï¼š`gitee:user/repo`
- æ·»åŠ è¶…æ—¶å¤„ç†å’Œé‡è¯•æœºåˆ¶
- è€ƒè™‘ä½¿ç”¨ `degit` æ›¿ä»£ `download-git-repo`

### 4. Windows ä¸‹è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼Ÿ

**é—®é¢˜**ï¼šåœ¨ Windows ç³»ç»Ÿä¸‹è·¯å¾„ä½¿ç”¨ `/` å¯¼è‡´é”™è¯¯ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
const path = require('path');

// ä½¿ç”¨ path.join è‡ªåŠ¨å¤„ç†ä¸åŒç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦
const filePath = path.join(projectName, 'src', 'index.js');

// é¿å…ç¡¬ç¼–ç è·¯å¾„åˆ†éš”ç¬¦
// âŒ const filePath = projectName + '/src/index.js';
// âœ” const filePath = path.join(projectName, 'src', 'index.js');
```

### 5. å¦‚ä½•è°ƒè¯•è„šæ‰‹æ¶ä»£ç ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ npm link åç›´æ¥è°ƒè¯•
npm link
your-cli create test-project

# æ–¹æ³•2ï¼šç›´æ¥è¿è¡Œ bin æ–‡ä»¶
node ./bin/index.js create test-project

# æ–¹æ³•3ï¼šä½¿ç”¨ VS Code è°ƒè¯•
# åœ¨ .vscode/launch.json ä¸­é…ç½®
{
  "type": "node",
  "request": "launch",
  "name": "Debug CLI",
  "program": "${workspaceFolder}/bin/index.js",
  "args": ["create", "test-project"]
}
```

### 6. è„šæ‰‹æ¶å¦‚ä½•æ”¯æŒ TypeScriptï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. å®‰è£… TypeScript å’Œç›¸å…³ä¾èµ–
npm install -D typescript @types/node ts-node

# 2. é…ç½® tsconfig.json
# 3. ä¿®æ”¹ package.json çš„ bin å­—æ®µ
"bin": {
  "my-cli": "./bin/index.js"  # ä»æŒ‡å‘ç¼–è¯‘åçš„ .js æ–‡ä»¶
}

# 4. æ·»åŠ æ„å»ºè„šæœ¬
"scripts": {
  "build": "tsc",
  "prepublishOnly": "npm run build"
}
```

### 7. å¦‚ä½•è®©è„šæ‰‹æ¶æ”¯æŒæ›´æ–°æç¤ºï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ `update-notifier` åº“ï¼š
```javascript
const updateNotifier = require('update-notifier');
const pkg = require('../package.json');

// æ£€æŸ¥æ›´æ–°
const notifier = updateNotifier({ pkg });
notifier.notify();
```

## å‚è€ƒ

[ã€å‰ç«¯æ¶æ„å¿…å¤‡ã€‘æ‰‹æ‘¸æ‰‹å¸¦ä½ æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„è„šæ‰‹æ¶](https://juejin.cn/post/7077717940941881358)

---
